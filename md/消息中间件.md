# 如何写个消息中间件

重要角色：

- 生产者

- 消费者

- Broker

- 注册中心

数据流转过程： 生产者 -> Broker(可暂存/持久化) -> 消费者

生产者生产消息，发送至Broker，Broker可以暂缓消息，然后消费者再从Broker获取消息，用于消费。

而注册中心用于服务的发现包括：Broker的发现、生产者的发现、消费者的发现，当然还包括下线，可以说服务的高可用离不开注册中心。

通信协议：自定义协议/GRPC等

注册中心：etcd/zookeeper/consul

扩容和整体性能：分布式的思想，像Kafka一样采取分区理念，一个Topic分为多个partition，并且为保证数据可靠性，采取多副本存储，即Leader和Follower，根据性能和数据可靠的权衡提供异步和同步的刷盘存储。

自动故障转移功能。
